version: 2.1

jobs:
  build:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - run:
          name: Install AWS CLI
          command: |
            apk add --no-cache python3 py3-pip
            pip install awscli
      - run:
          name: Install Terraform
          command: |
            export DEBIAN_FRONTEND=noninteractive
            curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg > /dev/null
            echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
            sudo apt-get update -y && sudo apt-get install -y terraform
            terraform version
      - run:
          name: Initialize Terraform
          command: terraform init
      - run:
          name: Validate Terraform Configuration
          command: terraform validate
      - run:
          name: Plan Terraform Deployment
          command: terraform plan
